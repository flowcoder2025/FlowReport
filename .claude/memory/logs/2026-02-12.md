# 2026-02-12 Daily Log

## 04:30 - Session Save (Epic A: 리포트 자동화 완료 + Hotfix)

### Completed

- [x] **Phase 1: DB 스키마 및 상수 정의**
- [x] **Phase 2: 이메일 서비스 구축**
- [x] **Phase 3: 리포트 생성 서비스**
- [x] **Phase 4: API 및 Cron**
- [x] **Phase 5: Settings UI**
- [x] **Hotfix: React Hooks 에러 수정**

## 14:00 - QA 테스트 및 28건 이슈 수정 세션 (완료)

## 14:30 - Ad-hoc: 채널 연동 버그 수정 + Vercel 배포 복구

### Completed

- [x] **GA4 자격증명 필드 수정**
  - `add-channel-modal.tsx`: `serviceAccount`(객체) → `serviceAccountJson`(문자열)
  - GA4Connector가 기대하는 형식과 일치시킴

- [x] **Meta OAuth 전체 구현**
  - `token.ts`: `fetchMetaAccountInfo` 플레이스홀더 → 실제 구현
    - `/me/accounts`로 페이지 목록 조회
    - Instagram: Business Account ID 추출
    - Facebook: Page ID 추출
    - 단기 토큰 → 장기 토큰(60일) 자동 교환
  - `callback/route.ts`: `buildCredentials()` 함수 추가
    - 채널별 올바른 자격증명 구조 저장
    - Meta: pageId, pageAccessToken, instagramBusinessAccountId
  - `meta.ts`: `getAccessToken()` 메서드 추가
    - pageAccessToken 우선 사용
  - `types.ts`: OAuthChannelInfo에 `extra` 필드 추가

- [x] **Vercel 배포 실패 해결 (2건)**
  - 원인 1: `src/constants/reports.ts` 미커밋 → index.ts가 import하는 파일 없음
  - 원인 2: Vercel Hobby 플랜 cron 제한 (매시간 불가) → 매일 자정으로 변경
  - 해결: 전체 미커밋 파일 일괄 커밋 + cron 스케줄 수정

- [x] **환경변수 추가 (.env)**
  - META_APP_ID, META_APP_SECRET (비어있음 - 발급 필요)
  - CRON_SECRET (로컬용 기본값)
  - RESEND_API_KEY, EMAIL_FROM (비어있음)

### In Progress
- [ ] Meta 연동 테스트 대기
  - 코드 준비 완료
  - META_APP_ID, META_APP_SECRET 발급 필요 (Facebook Developer Console)
  - Vercel 환경변수에도 동일 설정 필요

### Key Decisions
- Vercel Hobby 플랜: cron은 하루 1회만 가능 → 리포트 cron을 매일 자정으로 변경
- Meta OAuth: 장기 토큰 교환 + Page Access Token 우선 사용 방식 채택

### Git Commits
```
51e8850 fix: 채널 연동 버그 수정 - GA4, Meta OAuth, 환경변수
42e3f8e feat: 리포트 자동화 Epic + QA 28건 수정 + 채널 연동 개선
3858791 fix: Vercel Hobby 플랜 cron 제한 수정
```

### Modified Files (이 세션)
```
src/components/dashboard/add-channel-modal.tsx  - GA4 credential 필드 수정
src/lib/connectors/meta.ts                     - pageAccessToken, getAccessToken()
src/lib/oauth/internal/token.ts                - Meta OAuth 전체 구현
src/lib/oauth/types.ts                         - extra 필드 추가
src/app/api/auth/oauth/[provider]/callback/route.ts - buildCredentials()
vercel.json                                    - cron 스케줄 수정
.env                                           - 환경변수 추가
```

### Handoff Notes
- Vercel 배포 성공: https://flowreport.vercel.app
- YouTube 연동: 이미 동작 중 (FlowCoder 채널 연결됨)
- GA4 연동: 코드 수정 완료, 서비스 계정 JSON으로 테스트 가능

---

## 17:00 - Ad-hoc: Meta 채널 연동 완료 (Facebook + Instagram)

### Completed

- [x] **Facebook Developer Console 앱 설정**
  - FlowReport_ins 앱 (App ID: 907963014925273) 하나로 통합
  - FlowReport (Facebook 전용) 앱은 불필요 - 페이지 권한 없음
  - OAuth 리디렉션 URI 설정 완료
  - 권한: instagram_basic, instagram_manage_insights, instagram_content_publishing, pages_read_engagement, pages_show_list, business_management

- [x] **코드 수정: Meta 앱 통합**
  - `config.ts`: 단일 META_APP_ID/SECRET 사용, scope를 앱 실제 권한에 맞춤
  - `token.ts`: 통합 자격증명으로 장기 토큰 교환
  - `.env`: FlowReport_ins 앱 자격증명으로 통합

- [x] **코드 수정: Facebook 카드 추가**
  - `facebook-card.tsx`: 신규 (노출, 참여, 팬 증가, 페이지 조회)
  - `use-dashboard-data.ts`: FacebookMetrics 타입 + ChannelDetails에 META_FACEBOOK 추가
  - `metrics/route.ts`: Facebook 데이터 생성 로직 추가
  - `overview-view.tsx`: Facebook 카드 렌더링

- [x] **코드 수정: Meta 인사이트 에러 처리**
  - `meta.ts`: page_engaged_users(폐기) → page_post_engagements
  - 새 페이지(데이터 없음) 시 빈 데이터 반환 (에러 대신)

- [x] **코드 수정: 채널 추가 안내 문구**
  - `add-channel-modal.tsx`: Instagram/Facebook 사전 준비 안내 추가
  - Facebook: 비즈니스 페이지 필요
  - Instagram: 비즈니스/크리에이터 계정 + Facebook 페이지 연결 필요

- [x] **Vercel 환경변수 설정**
  - META_APP_ID, META_APP_SECRET → FlowReport_ins 앱으로 통합

- [x] **연동 테스트 성공**
  - Facebook (FlowCoder 페이지) 연결 + 동기화 성공
  - Instagram 연결 + 동기화 성공

### Key Decisions
- Meta 앱 1개로 통합: FlowReport_ins가 Facebook/Instagram 모두 처리
- Instagram 인사이트 조회 = Facebook 페이지 연결 필수 (Meta API 구조적 한계)
- 새 페이지 인사이트 미제공 시 빈 데이터 반환 (에러 대신 graceful)

### Modified Files
```
.env                                               - Meta 앱 자격증명 통합
src/lib/oauth/internal/config.ts                   - 단일 Meta 자격증명, scope 수정
src/lib/oauth/internal/token.ts                    - 통합 자격증명
src/lib/connectors/meta.ts                         - 메트릭명 수정, 에러 처리 개선
src/components/dashboard/add-channel-modal.tsx      - Meta 사전 준비 안내
src/components/dashboard/channel-metrics/internal/facebook-card.tsx - 신규
src/components/dashboard/channel-metrics/index.ts   - FacebookCard export
src/lib/hooks/use-dashboard-data.ts                - FacebookMetrics 타입
src/app/api/workspaces/[workspaceId]/metrics/route.ts - Facebook 데이터 생성
src/components/dashboard/views/internal/overview-view.tsx - Facebook 카드 렌더링
```

### Handoff Notes
- **커밋 및 배포 미완료** - 다음 세션에서 커밋 후 Vercel 배포 필요
- Facebook Developer Console: FlowReport(Facebook 전용) 앱은 삭제해도 됨
- 채널 연동 상태: YouTube ✅, Facebook ✅, Instagram ✅
- Vercel 환경변수 등록 완료 (META_APP_ID, META_APP_SECRET)

---

## 22:00 - Epic: SSOT 리팩토링 - 하드코딩 완전 제거 (완료)

### Completed

- [x] **Phase 1: SSOT 상수 구축 + 주요 하드코딩 제거**
  - `src/constants/channels.ts` 확장: CHANNEL_COLORS, BADGE_COLORS, DOT_COLORS, 헬퍼 함수
  - `src/constants/metrics.ts` 신규: METRIC_LABELS, METRIC_CATEGORIES, POSITIVE_METRICS, getMetricSeverity
  - API 3개, 서비스 2개, 컴포넌트 15개 하드코딩 제거

- [x] **Phase 2: 잔여 하드코딩 전수 조사 + 완전 제거**
  - `src/constants/colors.ts` 신규: CHART_PALETTE, FUNNEL_PALETTE, STATUS_COLORS 등 7개 컬러 상수
  - 차트 5개, 마케팅 4개, 블로그 2개, PDF 1개, 커넥터 2개 하드코딩 제거

### 결과
- **총 변경 파일**: 40개 (신규 2 + 수정 38)
- **TypeScript 빌드**: 에러 0
- **하드코딩 잔여**: 0건 (constants/ 외부)
- **SSOT 기준점**: channels.ts, metrics.ts, colors.ts 3파일 체제

### Key Decisions
- SSOT 3파일 체제: channels.ts (채널), metrics.ts (메트릭), colors.ts (UI 컬러)
- 래퍼 함수 유지: 각 파일의 getChannelLabel은 CHANNEL_LABELS 참조하는 래퍼로 유지
- CHANNEL_GROUPS.SNS 사용: 기존 하드코딩 배열을 그룹 상수로 교체

### Handoff Notes
- **커밋 미완료** - 다음 세션에서 커밋 필요
- SUPANOVA 디자인 시스템(FlowHR/design-interactive-components): 랜딩페이지 제작용, 현재 작업과 무관
